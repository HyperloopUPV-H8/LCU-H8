#pragma once
#include "LCU_Pinout/Pinout.hpp"
#include "LCU_Mode/LCU_Mode.hpp"
#include "LPU_HalfBridge.hpp"
#include "DigitalOutput/DigitalOutput.hpp"
#include "PWM/PWM/PWM.hpp"


namespace LCU{
	class Actuators{
	public:
    	LPU_HalfBridge HEMS_2, HEMS_4, EMS_2, EMS_4;
    	DigitalOutput led_sleep, led_flash, led_fault, led_operational, led_can;
    	void init();
    	void turn_off();
    	void turn_on();
    private:
        static constexpr float default_pwm_frequency = 20000;
        DigitalOutput buffer_enable {Pinout::BUFFER_EN_PIN};
        PWM HEMS2_H1 = {Pinout::HEMS2_H1_PIN}, HEMS2_H2 = {Pinout::HEMS2_H2_PIN}, HEMS4_H1 = {Pinout::HEMS4_H1_PIN}, HEMS4_H2 = {Pinout::HEMS4_H2_PIN}, EMS2_H1 = {Pinout::EMS2_H1_PIN}, EMS2_H2 = {Pinout::EMS2_H2_PIN}, EMS4_H1 = {Pinout::EMS4_H1_PIN}, EMS4_H2 = {Pinout::EMS4_H2_PIN};
    public:
        Actuators() : HEMS_1(&HEMS1_H1, &HEMS1_H2), HEMS_3(&HEMS3_H1, &HEMS3_H2), EMS_1(&EMS1_H1, &EMS1_H2), EMS_3(&EMS3_H1, &EMS3_H2),
				led_sleep(Pinout::SLEEP_LED_PIN), led_flash(Pinout::FLASH_LED_PIN), led_fault(Pinout::FAULT_LED_PIN),
				led_operational(Pinout::OPERATIONAL_LED_PIN), led_can(Pinout::CAN_LED_PIN)
        		{}
	};

    template<>
    class Actuators<VEHICLE_5DOF>{
    public:
    	LPU_HalfBridge HEMS_1, HEMS_3, EMS_1, EMS_3;
    	DigitalOutput led_sleep, led_flash, led_fault, led_operational, led_can;
    	void init();
    	void turn_off();
    	void turn_on();
    private:
        static constexpr float default_pwm_frequency = 20000;
        DigitalOutput buffer_enable {Pinout::BUFFER_EN_PIN};
        PWM HEMS1_H1 = {Pinout::HEMS1_H1_PIN}, HEMS1_H2 = {Pinout::HEMS1_H2_PIN}, HEMS3_H1 = {Pinout::HEMS3_H1_PIN}, HEMS3_H2 = {Pinout::HEMS3_H2_PIN}, EMS1_H1 = {Pinout::EMS1_H1_PIN}, EMS1_H2 = {Pinout::EMS1_H2_PIN}, EMS3_H1 = {Pinout::EMS3_H1_PIN}, EMS3_H2 = {Pinout::EMS3_H2_PIN};
    public:
        Actuators() : HEMS_1(&HEMS1_H1, &HEMS1_H2), HEMS_3(&HEMS3_H1, &HEMS3_H2), EMS_1(&EMS1_H1, &EMS1_H2), EMS_3(&EMS3_H1, &EMS3_H2),
				led_sleep(Pinout::SLEEP_LED_PIN), led_flash(Pinout::FLASH_LED_PIN), led_fault(Pinout::FAULT_LED_PIN),
				led_operational(Pinout::OPERATIONAL_LED_PIN), led_can(Pinout::CAN_LED_PIN)
        		{}
    };

    void Actuators<VEHICLE_5DOF>::init(){
        HEMS_1.turn_on();
        HEMS_3.turn_on();
        EMS_1.turn_on();
        EMS_3.turn_on();
        HEMS_1.set_frequency(default_pwm_frequency);
        HEMS_3.set_frequency(default_pwm_frequency);
        EMS_1.set_frequency(default_pwm_frequency);
        EMS_3.set_frequency(default_pwm_frequency);
        HEMS_1.set_duty_cycle(0);
        HEMS_3.set_duty_cycle(0);
        EMS_1.set_duty_cycle(0);
        EMS_3.set_duty_cycle(0);
        buffer_enable.turn_off();
    }
    void Actuators<VEHICLE_5DOF>::turn_off(){
    	buffer_enable.turn_on();
        HEMS_1.turn_off();
        HEMS_3.turn_off();
        EMS_1.turn_off();
        EMS_3.turn_off();
    }

    void Actuators<VEHICLE_5DOF>::turn_on(){
        HEMS_1.set_duty_cycle(0);
        HEMS_3.set_duty_cycle(0);
        EMS_1.set_duty_cycle(0);
        EMS_3.set_duty_cycle(0);
        HEMS_1.turn_on();
        HEMS_3.turn_on();
        EMS_1.turn_on();
        EMS_3.turn_on();
        buffer_enable.turn_off();
    }
}

