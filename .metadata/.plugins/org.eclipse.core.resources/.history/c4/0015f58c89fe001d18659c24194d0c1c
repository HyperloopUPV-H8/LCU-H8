#pragma once
#include "LCU_Actuators/LCU_Actuators.hpp"
#include "LCU_Data/LCU_Data.hpp"
#include "CurrentControl.hpp"

namespace LCU {
	class Control{
	public:
    	CurrentControl hems_2_current_control, hems_4_current_control, ems_2_current_control, ems_4_current_control;
    	float& hems_2_current, &hems_4_current, &ems_2_current, &ems_4_current;
    	Control(LCU::Actuators& actuators, LCU::Data& data): hems_2_current_control(actuators.HEMS_2,data.reference_currents[COIL_ID::HEMS_2]),
    			hems_4_current_control(actuators.HEMS_4, data.reference_currents[COIL_ID::HEMS_4]),
    			ems_2_current_control(actuators.EMS_2, data.reference_currents[COIL_ID::EMS_2]),
				ems_4_current_control(actuators.EMS_4, data.reference_currents[COIL_ID::EMS_4]),
				hems_2_current(data.coil_current_hems_2),
				hems_4_current(data.coil_current_hems_4),
				ems_2_current(data.coil_current_ems_2),
				ems_4_current(data.coil_current_ems_4)
    	{}

    	void execute_current_control(){
    		hems_2_current_control.control(hems_2_current);
    		hems_4_current_control.control(hems_4_current);
			ems_2_current_control.control(ems_2_current);
			ems_4_current_control.control(ems_4_current);
			hems_2_current_control.apply_control();
			hems_4_current_control.apply_control();
			ems_2_current_control.apply_control();
			ems_4_current_control.apply_control();
    	}

    	void stop(){
    		hems_2_current_control.half_bridge.turn_off();
    		hems_4_current_control.half_bridge.turn_off();
			ems_2_current_control.half_bridge.turn_off();
			ems_4_current_control.half_bridge.turn_off();
    	}

    	void reset(){
    		hems_1_current_control.reset();
    		hems_3_current_control.reset();
    		ems_1_current_control.reset();
    		ems_3_current_control.reset();
    		hems_1_current_control.half_bridge.turn_on();
    		hems_3_current_control.half_bridge.turn_on();
			ems_1_current_control.half_bridge.turn_on();
			ems_3_current_control.half_bridge.turn_on();
    	}
	};
}


